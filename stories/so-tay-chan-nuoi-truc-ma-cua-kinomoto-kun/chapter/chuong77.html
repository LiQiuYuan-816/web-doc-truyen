
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
 <title>ChÆ°Æ¡ng 77</title>

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Serif&family=Playfair+Display:wght@600;700&display=swap"
    rel="stylesheet"
  >

  <!-- Style dÃ¹ng chung -->
  <link rel="stylesheet" href="../style.css">
</head>

<body class="page-chapter">
<body class="page-chapter">

  <!-- ===== NÃšT Má» THÆ¯ VIá»†N (TRÃI) ===== -->
  <div class="menu-toggle" onclick="toggleLibrary()">â˜°</div>

  <div class="overlay" id="overlay" onclick="toggleLibrary()"></div>

  <div class="library-sidebar" id="librarySidebar">
    <div class="library-header">
      ğŸ“š ThÆ° viá»‡n
      <span class="close-btn" onclick="toggleLibrary()">âœ•</span>
    </div>

    <input type="text" id="searchInput" placeholder="TÃ¬m truyá»‡n..." />
    <ul id="storyList"></ul>
  </div>


  <!-- ===== NÃšT Má» Má»¤C Lá»¤C (PHáº¢I) ===== -->
  <div class="chapter-menu-toggle" onclick="toggleChapterMenu()">ğŸ“‘</div>

  <div id="chapterOverlay" class="chapter-overlay" onclick="toggleChapterMenu()"></div>

  <div id="chapterSidebar" class="chapter-sidebar">
    <div class="chapter-sidebar-header">
      ğŸ“š Má»¥c lá»¥c
      <span class="close-btn" onclick="toggleChapterMenu()">âœ•</span>
    </div>

    <ul id="chapterList"></ul>
  </div>
<!-- ================= HEADER ================= -->
<div class="fixed-top">
  <div class="fixed-inner page-chapter">

    <!-- LEFT -->
    <div class="top-left">
      <a class="back-link" href="../index.html">ğŸ“‘ Má»¥c lá»¥c</a>
      <a class="back-link" href="../../../index.html">ğŸ  Trang chá»§</a>
      <a class="back-link" href="../../../thu-vien-ten/name-library.html">ğŸ“– ThÆ° viá»‡n tÃªn</a>
      <button id="bookmarkBtn" class="back-link">ğŸ“Œ Káº¹p sÃ¡ch</button>
    </div>
    <!-- CENTER -->
    <div class="novel-header top-center">
      <h1 class="novel-title">
        Sá»• Tay ChÄƒn NuÃ´i TrÃºc MÃ£ Cá»§a Kinomoto-Kun
      </h1>
      <div class="novel-meta">
        <span>ChÆ°Æ¡ng 77</span>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="top-right">
      <a class="back-link" href="chuong76.html">â® ChÆ°Æ¡ng trÆ°á»›c</a>
      <a class="back-link" href="chuong78.html">â­ ChÆ°Æ¡ng sau</a>
    </div>
  </div>
</div>

<!-- ================= CONTENT ================= -->
<main>
<div class="content chapter-content">

        <p>XÃ  ÄÃ¡i nÃ y vÃ i tháº­p niÃªn á»Ÿ tháº§n xÃ£ sÃºc, tuy ráº±ng dá»±a vÃ o Äƒn vá»¥ng nhÃ¢n loáº¡i cung phá»¥ng tháº§n minh hiáº¿n táº¿ sinh tá»“n, nhÆ°ng cÅ©ng cÅ©ng chá»‰ lÃ  tá»“n táº¡i thÃ´i.</p>
        <p>Touya Ä‘em XÃ  ÄÃ¡i Ä‘áº·t á»Ÿ trong phÃ²ng ngá»§ uy gáº§n má»™t vÃ²ng táº£ há»¯u thá»i gian, XÃ  ÄÃ¡i nhan sáº¯c má»›i tá»« xÃ¡m xá»‹t mÃ u xanh lá»¥c biáº¿n thÃ nh tÆ°Æ¡i Ä‘áº¹p bá»™ dÃ¡ng, chá»£t vá»«a tháº¥y Ä‘i lÃªn tháº­m chÃ­ nhÆ° lÃ  dá»¥ng tÃ¢m thÃªu khÃ´ng Ã­t thÃªu hoa dáº£i lá»¥a.</p>
        <p>Tuy ráº±ng cÃ¹ng XÃ  ÄÃ¡i kÃ½ káº¿t kháº¿ Æ°á»›c chÃ­nh lÃ  Touya, nhÆ°ng lÃ  chá»‰ cáº§n Touya cÃ²n á»Ÿ táº¡i Kinomoto gia, XÃ  ÄÃ¡i lÃ  cÃ³ thá»ƒ Ä‘em Kinomoto gia sáº£n lÃ m chÃ­nh mÃ¬nh báº£o há»™ gia Ä‘Ã¬nh, tá»± nhiÃªn cÅ©ng cÃ³ thá»ƒ phÃ¹ há»™ Kinomoto gia gia Ä‘Ã¬nh thÃ nh viÃªn.</p>
        <p>á» Sakura ngáº«u nhiÃªn tá»›i Touya bÃªn nÃ y táº·ng Ä‘á»“ thá»i Ä‘iá»ƒm, XÃ  ÄÃ¡i cÃ²n cÃ³ thá»ƒ thÆ°á»ng thÆ°á»ng kÃ©o má»™t ngá»¥m Sakura dáº­t trÃ n ra tá»›i ma lá»±c thay Ä‘á»•i kháº©u vá»‹.</p>
        <p>. Äƒn Ä‘áº¿n hai song xÃ  Ä‘Ã´i máº¯t cÃ ng thÃªm tinh quang láº­p loÃ¨, thÃ¢n thá»ƒ cÅ©ng khÃ´ng há» giá»‘ng phÃ­a trÆ°á»›c nhÆ° váº­y nhÃ¬n qua cÃ¹ng loáº¡i xÃ  mÆ°á»£t mÃ , ngÆ°á»£c láº¡i cÃ ng thÃªm báº¹p lÃªn.</p>
        <p>CÃ³ Ä‘Ã´i khi nháº¯m máº¯t láº¡i, ngay cáº£ Kero cÃ¹ng nguyá»‡t cÃ³ Ä‘Ã´i khi Ä‘á»u pháº£n á»©ng khÃ´ng ká»‹p nÃ³ tá»“n táº¡i, ngá»¥y trang mÃ  tháº­p pháº§n Ä‘Ãºng chá»—.</p>
        <p>Trá»« bá» duy trÃ¬ sinh tá»“n, cÃ²n cÃ³ dÆ° thá»«a ma lá»±c tiáº¿n hÃ nh ngá»¥y trang, Ä‘Ã¢y cÅ©ng lÃ  XÃ  ÄÃ¡i ma lá»±c báº¯t Ä‘áº§u khÃ´i phá»¥c Ä‘áº¿n bÃ¬nh thÆ°á»ng trÃ¬nh Ä‘á»™ bÃ y ra.</p>
        <p>HÃ´m nay buá»•i sÃ¡ng, Touya xÃ¡ch theo tÃº cáº§u xuá»‘ng láº§u, Sakura tiáº¿ng bÆ°á»›c chÃ¢n cÅ©ng tá»« trÃªn láº§u thá»‹ch thá»‹ch thá»‹ch truyá»n xuá»‘ng tá»›i.</p>
        <p>â€œCa ca buá»•i sÃ¡ng tá»‘t lÃ nh!â€ Sakura Äƒn máº·c xinh Ä‘áº¹p tiá»ƒu vÃ¡y, hÆ°á»›ng tá»›i Touya chÃ o há»i, liá»n hÆ°á»›ng phÃ²ng báº¿p cháº¡y.</p>
        <p>â€œCháº¡y nhanh nhÆ° váº­y Ä‘á»ƒ Ã½ tÃ© ngÃ£.â€</p>
        <p>Touya giá»ng nÃ³i cÃ²n khÃ´ng cÃ³ rÆ¡i xuá»‘ng, Sakura tiáº¿ng kinh hÃ´ liá»n vang lÃªn.</p>
        <p>â€œA!â€</p>
        <p>Touya ba bÆ°á»›c cÅ©ng lÃ m hai bÆ°á»›c nháº£y xuá»‘ng thang láº§u, vá»™i vÃ£ hÆ°á»›ng tá»›i nhÃ  Äƒn Ä‘i Ä‘áº¿n, liá»n tháº¥y Sakura ngá»“i trÃªn sÃ n nhÃ , Ã´m bá»‹ cáº¯t má»™t lá»— há»•ng lÃ n vÃ¡y khÃ³c khÃ´ng ra nÆ°á»›c máº¯t.</p>
        <p>â€œCa caâ€¦â€¦â€ Tiá»ƒu cÃ´ nÆ°Æ¡ng ngáº©ng Ä‘áº§u, Ä‘Ã´i máº¯t há»“ng há»“ng.</p>
        <p>Touya nháº­n ra Ä‘Ã¢y lÃ  ba ba tÃ¢n mua cáº¥p Sakura vÃ¡y, phÃ­a trÆ°á»›c cÅ©ng chÆ°a tháº¥y tiá»ƒu cÃ´ nÆ°Æ¡ng xuyÃªn qua, hÃ´m nay chá»‰ sá»£ lÃ  láº§n Ä‘áº§u tiÃªn.</p>
        <p>Háº¯n thá»Ÿ dÃ i: â€œLá»— mÃ£ng háº¥p táº¥p, khÃ´ng nÃ©m tá»›i Ä‘i?â€</p>
        <p>â€œKhÃ´ng cÃ³.â€ Sakura chá»›p chá»›p máº¯t, Ä‘em lÃ n vÃ¡y hÆ°á»›ng Touya trÆ°á»›c máº·t Ä‘á»‡.</p>
        <p>Touya báº¥t Ä‘áº¯c dÄ©, giÆ¡ tay náº¯m tay chá»‘ng nhÃ  mÃ¬nh tiá»ƒu quÃ¡i thÃº Ä‘áº§u nháº¹ nhÃ ng gÃµ hai cÃ¡i: â€œLáº§n sau cho ta háº£o háº£o xuá»‘ng láº§u, khÃ´ng chuáº©n cháº¡y mau.â€</p>
        <p>â€œBiáº¿t rá»“i biáº¿t rá»“i.â€</p>
        <p>Huyá»n quan chá»— má»Ÿ cá»­a thanh Ã¢m vang lÃªn, Yukito cÃ¹ng Fujitaka ba ba dáº«n theo siÃªu thá»‹ tÃºi mua hÃ ng Ä‘i vÃ o, tháº¥y Sakura ngá»“i trÃªn sÃ n nhÃ , Touya cÅ©ng ngá»“i xá»•m á»Ÿ bÃªn ngÆ°á»i nÃ ng, vá»™i vÃ ng tiáº¿n lÃªn hai bÆ°á»›c, quan tÃ¢m nÃ³i: â€œLÃ m sao váº­y?â€</p>
        <p>â€œKhÃ´ng, khÃ´ng cÃ³ láº¡pâ€¦â€¦â€ Sakura luá»‘ng cuá»‘ng tay chÃ¢n mÃ  che láº¡i chÃ­nh mÃ¬nh lÃ n vÃ¡y, gÆ°Æ¡ng máº·t há»“ng há»“ng.</p>
        <p>Tuy ráº±ng hiá»‡n táº¡i má»—i ngÃ y Ä‘á»u cÃ³ thá»ƒ nhÃ¬n Ä‘áº¿n Yukito ca ca, hÆ¡n ná»¯a cÅ©ng biáº¿t Yukito ca ca cÃ¹ng ca ca quan há»‡, nhÆ°ng lÃ  tiá»ƒu cÃ´ nÆ°Æ¡ng nhÃ¬n Ä‘áº¿n Yukito váº«n lÃ  sáº½ nhá»‹n khÃ´ng Ä‘Æ°á»£c tháº¹n thÃ¹ng.</p>
        <p>â€œVá»«a rá»“i xuá»‘ng thang láº§u cháº¡y quÃ¡ nhanh, lÃ n vÃ¡y bá»‹ thá»© gÃ¬ cáº¯t qua.â€ Touya tá»« trÆ°á»›c Ä‘áº¿n nay lÃ  má»™t chÃºt máº·t mÅ©i Ä‘á»u khÃ´ng cho tiá»ƒu cÃ´ nÆ°Æ¡ng lÆ°u.</p>
        <p>Sakura nheo máº¯t, liá»u máº¡ng tÃºm Touya tay Ã¡o Ã½ Ä‘á»“ lÃ m xÃº ca ca cÃ¢m miá»‡ng.</p>
        <p>Yukito cong máº·t mÃ y cÆ°á»i háº¡ nÃ³i: â€œKhÃ´ng thÆ°Æ¡ng Ä‘áº¿n liá»n háº£o, Sakura hÃ´m nay khÃ´ng pháº£i cÃ²n muá»‘n cÃ¹ng Ä‘á»“ng há»c Ä‘i Äƒn cÆ¡m dÃ£ ngoáº¡i sao?â€</p>
        <p>LÃºc trÆ°á»›c Yukito lÃªn vá»«a lÃºc gáº·p pháº£i Fujitaka ba ba á»Ÿ phÃ²ng báº¿p cáº¥p Sakura lÃ m Äƒn cÆ¡m dÃ£ ngoáº¡i tiá»‡n lá»£i, cÅ©ng cÃ¹ng nhau lÃ m Ä‘iá»ƒm tÃ¢m ngá»t, chuáº©n bá»‹ xong lÃºc sau hai ngÆ°á»i Ä‘Æ¡n giáº£n liá»n cÃ¹ng nhau Ä‘i ra cá»­a mua nguyÃªn liá»‡u náº¥u Äƒn.</p>
        <p>â€œÃ‚n Ã¢n Ã¢n!â€ Sakura liÃªn tá»¥c gáº­t Ä‘áº§u.</p>
        <p>Fujitaka ba ba tá»« bÃªn cáº¡nh cáº§m may bao láº¡i Ä‘Ã¢y, giÆ¡ tay vá»— vá»— Touya cÃ¹ng Yukito báº£ vai, cÆ°á»i nÃ³i: â€œÄÆ°á»£c rá»“i, ta Ä‘áº¿n Ä‘Ã¢y Ä‘i, Touya khÃ´ng pháº£i cÃ²n cÃ³ chuyá»‡n pháº£i lÃ m?â€</p>
        <p>Touya cÃ¹ng Yukito trÃ¡nh ra Ä‘á»‹a phÆ°Æ¡ng, Fujitaka ba ba ngá»“i á»Ÿ Sakura bÃªn cáº¡nh, á»Ÿ tiá»ƒu cÃ´ nÆ°Æ¡ng phÃ¡ vá»¡ lÃ n vÃ¡y chá»— má»™t chÃºt may vÃ¡ ra tá»© giÃ¡c tinh thÃªu hoa.</p>
        <p>Yukito Ä‘i Ä‘em vá»«a rá»“i Ä‘áº·t á»Ÿ huyá»n quan tÃºi Ä‘á» Ä‘i phÃ²ng báº¿p, nguyÃªn liá»‡u náº¥u Äƒn phÃ¢n loáº¡i bá» vÃ o tá»§ láº¡nh chá»©a Ä‘á»±ng.</p>
        <p>Touya cÃ²n láº¡i lÃ  xÃ¡ch theo trang XÃ  ÄÃ¡i tÃº cáº§u Ä‘i Ä‘áº¿n huyá»n quan chá»— má»Ÿ cá»­a, Ä‘em tÃº cáº§u treo á»Ÿ khung cá»­a biÃªn dá»±a trong phÃ²ng kia má»™t máº·t tiá»ƒu mÃ³c ná»‘i thÆ°á»£ng.</p>
        <p>Vá»«a rá»“i Äƒn vá»¥ng hai non anh ma lá»±c XÃ  ÄÃ¡i giáº­t giáº­t thÃ¢n thá»ƒ, nhá» giá»ng nÃ³i: â€œNhÃ  ngÆ°Æ¡i háº£o ká»³ quÃ¡i Ã¡c.â€</p>
        <p>Touya: â€œÃ‚n?â€</p>
        <p>â€œNgÆ°Æ¡i gia há»a nÃ y vÃ¬ cÃ¡i gÃ¬ sáº½ cÃ³ nhÆ° váº­y Ä‘iá»m má»¹ Ä‘Ã¡ng yÃªu muá»™i muá»™i a? RÃµ rÃ ng ba ba cÅ©ng lá»›n lÃªn nhÆ° váº­y tuáº¥n má»¹ Ã´n nhu.â€ XÃ  ÄÃ¡i nÃ³i chuyá»‡n chá»§ Ä‘Ã¡nh má»™t cÃ¡i lÃ¡ gan Ä‘áº¡i.</p>
        <p>Touya thÃ¡i dÆ°Æ¡ng má»™t Ä‘á»™t: â€œâ€¦â€¦ NgÆ°Æ¡i tin hay khÃ´ng ta Ä‘em ngÆ°Æ¡i nhá»‘t á»Ÿ ngoÃ i cá»­a máº·t?â€</p>
        <p>XÃ  ÄÃ¡i láº­p tá»©c háº¡ giá»ng, tÃª tÃª tÃª mÃ  cÆ°á»i rá»™ lÃªn.</p>
        <p>â€œA, cáº£m giÃ¡c XÃ  ÄÃ¡i tiÃªn sinh trá»Ÿ nÃªn tháº­t xinh Ä‘áº¹p Ä‘Ã¢u.â€ Yukito Ä‘i Ä‘áº¿n Touya bÃªn ngÆ°á»i, cÅ©ng ngáº©ng Ä‘áº§u nhÃ¬n treo á»Ÿ cáº¡nh cá»­a tÃº cáº§u.</p>
        <p>XÃ  ÄÃ¡i thÃ¬nh lÃ¬nh bá»‹ tháº³ng cáº§u khÃ­ch lá»‡, tháº¹n thÃ¹ng Ä‘áº¿n thÃ¢n thá»ƒ phiáº¿m Ä‘á» háº£o má»™t Ä‘oáº¡n.</p>
        <p>Fujitaka ba ba cÃ¹ng Sakura khÃ´ng biáº¿t khi nÃ o cÅ©ng Ä‘i tá»›i, tiá»ƒu cÃ´ nÆ°Æ¡ng lÃ n vÃ¡y hoÃ n toÃ n nhÃ¬n khÃ´ng ra váº¿t ná»©t, chá»‰ cÃ³ Ä‘Ã¡ng yÃªu trÃ²n vo ngÃ´i sao trá»¥y á»Ÿ vÃ¡y biÃªn.</p>
        <p>Fujitaka ba ba nhÃ¬n tÃº cáº§u, Ã¡nh máº¯t hoáº£ng há»‘t má»™t cÃ¡i chá»›p máº¯t, rá»“i sau Ä‘Ã³ nháº¹ giá»ng nÃ³i: â€œCÃ¡i nÃ y Ä‘á»‹a phÆ°Æ¡ng, phÃ­a trÆ°á»›c váº«n lÃ  bá»Ÿi vÃ¬ Nadeshiko thá»±c thÃ­ch quáº£i thá»§ cÃ´ng chuÃ´ng giÃ³, cho nÃªn má»›i sáº½ chuyÃªn mÃ´n lÃ m mÃ³c ná»‘i.â€</p>
        <p>â€œBá»Ÿi vÃ¬ Nadeshiko thá»±c thÃ­ch nghe Ä‘Æ°á»£c ngÆ°á»i trong nhÃ  khi trá»Ÿ vá» chuÃ´ng giÃ³ leng keng rung Ä‘á»™ng thanh Ã¢m.â€ Fujitaka ba ba Ã´n nhu mÃ  cÆ°á»i.</p>
        <p>Sakura nhÃ³n chÃ¢n nhÃ¬n ká»¹ xem tÃº cáº§u, lá»›n tiáº¿ng nÃ³i: â€œChÃºng ta Ä‘Ã¢y cÅ©ng tá»›i lÃ m má»™t cÃ¡i chuÃ´ng giÃ³ treo á»Ÿ tÃº cáº§u phÃ­a dÆ°á»›i Ä‘i!â€</p>
        <p>â€¦â€¦</p>
        <p>â€œBa ba, ca ca, Yukito ca, ta ra cá»­a láº¡p!â€</p>
        <p>Sakura xÃ¡ch theo chuáº©n bá»‹ tá»‘t tiá»‡n lá»£i há»™p, mang lÃªn Ä‘Ã¡ng yÃªu ngÃ´i sao mÅ©, kÃ©o ra mÃ´n, Ä‘á»©ng á»Ÿ huyá»n quan chá»— lá»›n tiáº¿ng kÃªu.</p>
        <p>â€œTrÃªn Ä‘Æ°á»ng tiá»ƒu tÃ¢m nga!â€</p>
        <p>â€œChÃº Ã½ an toÃ n.â€</p>
        <p>â€œChÆ¡i Ä‘áº¿n vui váº» Ã¡c.â€</p>
        <p>â€œÃ‚n Ã¢n ï½â€</p>
        <p>Tiá»ƒu cÃ´ nÆ°Æ¡ng má»Ÿ cá»­a Ä‘Ã³ng cá»­a thanh Ã¢m rÆ¡i xuá»‘ng, giÃ³ thá»•i qua Kinomoto gia cÃ¡nh cá»­a, Ä‘em tÃº cáº§u háº¡ chuÃ´ng giÃ³ thá»•i Ä‘áº¿n leng keng rung Ä‘á»™ng.</p>
        <p>TÃº cáº§u XÃ  ÄÃ¡i ngÃ¡p má»™t cÃ¡i, tÃª tÃª nÃ³i: â€œBÃ¬nh an may máº¯n, thuáº­n buá»“m xuÃ´i giÃ³ ï½â€</p>
        <p>Ma lá»±c chá»‹u táº£i thá»§ gia yÃªu Ä‘áº·c cÃ³ chÃºc phÃºc, xáº¹t qua ngÃ y xuÃ¢n Ã¡nh máº·t trá»i, nháº¹ nhÃ ng gáº¯n vÃ o lÃ n vÃ¡y phi dÆ°Æ¡ng tiá»ƒu cÃ´ nÆ°Æ¡ng trÃªn ngÆ°á»i.</p>
        <p>NgÃ y xuÃ¢n áº¥m dÆ°Æ¡ng, phá»“n hoa tá»±a cáº©m.</p>
        <p>-------------DFY--------------</p>






































































































































































































































































































































































































































































































































































<!-- ===== NAV DÆ¯á»šI ===== -->
<div class="nav">
      <a class="back-link" href="../index.html">ğŸ“‘ Má»¥c lá»¥c</a>
      <a class="back-link" href="../../../index.html">ğŸ  Trang chá»§</a>
      <a class="back-link" href="../../../thu-vien-ten/name-library.html">ğŸ“– ThÆ° viá»‡n tÃªn</a>
      <a class="back-link" href="chuong76.html">â® ChÆ°Æ¡ng trÆ°á»›c</a>
      <a class="back-link" href="chuong78.html">â­ ChÆ°Æ¡ng sau</a>
</div>
  </main>
<!-- ================= BOOKMARK ================= -->
<script>
const NOVEL_ID = "so-tay-chan-nuoi-truc-ma-cua-kinomoto-kun";
const NOVEL_TITLE = "Sá»• Tay ChÄƒn NuÃ´i TrÃºc MÃ£ Cá»§a Kinomoto-Kun";
const CHAPTER_TITLE = "ChÆ°Æ¡ng 77";
const btn = document.getElementById("bookmarkBtn");
function getBookmarks() {
  return JSON.parse(localStorage.getItem("bookmarks")) || {};
}
function isBookmarked() {
  return !!getBookmarks()[NOVEL_ID];
}
function updateButton() {
  const marked = isBookmarked();
  btn.textContent = marked ? "âœ… ÄÃ£ káº¹p" : "ğŸ“Œ Káº¹p sÃ¡ch";
  btn.classList.toggle("active", marked);
}
function toggleBookmark() {
  const bookmarks = getBookmarks();
  if (bookmarks[NOVEL_ID]) {
    delete bookmarks[NOVEL_ID];
    alert("âŒ ÄÃ£ bá» káº¹p sÃ¡ch");
  } else {
    bookmarks[NOVEL_ID] = {
      novelTitle: NOVEL_TITLE,
      chapterTitle: CHAPTER_TITLE,
      url: location.href,
      time: Date.now()
    };
    alert("ğŸ“Œ ÄÃ£ lÆ°u chÆ°Æ¡ng Ä‘ang Ä‘á»c");
  }
  localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
  updateButton();
}
updateButton();
btn.addEventListener("click", toggleBookmark);
</script>
<!-- ================= HEADER SHRINK ================= -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  /* =========================
     HEADER SHRINK + PADDING
  ========================== */

  const fixedHeader = document.querySelector(".fixed-top");
  const main = document.querySelector("main");

  function adjustMainPadding() {
    if (!fixedHeader || !main) return;
    main.style.paddingTop = fixedHeader.offsetHeight + 20 + "px";
  }

  function handleHeaderShrink() {
    if (!fixedHeader) return;
    fixedHeader.classList.toggle("shrink", window.scrollY > 80);
    adjustMainPadding();
  }

  window.addEventListener("scroll", handleHeaderShrink);
  window.addEventListener("resize", adjustMainPadding);
  adjustMainPadding();


  /* =========================
     SIDEBAR THÆ¯ VIá»†N (TRÃI)
  ========================== */

  const sidebar = document.getElementById("librarySidebar");
  const overlay = document.getElementById("overlay");
  const storyList = document.getElementById("storyList");
  const searchInput = document.getElementById("searchInput");

  function toggleLibrary() {
    if (!sidebar || !overlay) return;
    sidebar.classList.toggle("active");
    overlay.classList.toggle("active");
  }

  window.toggleLibrary = toggleLibrary;

  let storiesData = [];

  fetch("../../../stories.json")
    .then(res => res.json())
    .then(data => {
      storiesData = data;
      renderStories(data);
    })
    .catch(err => console.error("Lá»—i load stories.json:", err));

  function renderStories(data) {
    if (!storyList) return;

    storyList.innerHTML = "";

    const pathParts = window.location.pathname.split("/");
    const currentSlug = pathParts[2];

    data.forEach((story, index) => {
      const li = document.createElement("li");
      li.style.animationDelay = `${Math.min(index * 0.03, 0.3)}s`;

      const a = document.createElement("a");
      a.href = `/web-doc-truyen/stories/${story.slug}/`;
      a.textContent = `${story.title} (${story.chapters} chÆ°Æ¡ng)`;

      if (story.slug === currentSlug) {
        a.style.background = "#e0e7ff";
      }

      li.appendChild(a);
      storyList.appendChild(li);
    });
  }

  if (searchInput) {
    searchInput.addEventListener("input", function () {
      const keyword = this.value.toLowerCase();
      const filtered = storiesData.filter(story =>
        story.title.toLowerCase().includes(keyword)
      );
      renderStories(filtered);
    });
  }


  /* =========================
     SIDEBAR Má»¤C Lá»¤C CHÆ¯Æ NG (PHáº¢I)
  ========================== */

  const chapterSidebar = document.getElementById("chapterSidebar");
  const chapterOverlay = document.getElementById("chapterOverlay");
  const chapterList = document.getElementById("chapterList");

  function toggleChapterMenu() {
    if (!chapterSidebar || !chapterOverlay) return;
    chapterSidebar.classList.toggle("active");
    chapterOverlay.classList.toggle("active");
  }

  window.toggleChapterMenu = toggleChapterMenu;

  if (chapterList) {
    fetch("../index.html")
      .then(res => res.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");

        const toc = doc.querySelector(".content ul");
        if (!toc) return;

        const currentPage = window.location.pathname.split("/").pop();

        toc.querySelectorAll("li").forEach(li => {
          const a = li.querySelector("a");
          if (!a) return;

          let href = a.getAttribute("href");

          if (href.startsWith("chapter/")) {
            href = href.replace("chapter/", "");
          }

          const newLi = document.createElement("li");
          const newA = document.createElement("a");

          newA.href = href;
          newA.textContent = a.textContent;

          if (href === currentPage) {
            newA.style.background = "#e0e7ff";
          }

          newLi.appendChild(newA);
          chapterList.appendChild(newLi);
        });
      })
      .catch(err => console.error("KhÃ´ng load Ä‘Æ°á»£c má»¥c lá»¥c:", err));
  }

});
</script>
</body>
</html>
