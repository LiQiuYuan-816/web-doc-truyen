<script>
  const header = document.querySelector('.fixed-top');
  const main = document.querySelector('main');

  function updateLayout() {
    const headerHeight = header.offsetHeight;
    main.style.paddingTop = headerHeight + 'px';
  }

  window.addEventListener('scroll', () => {
    if (window.scrollY > 80) {
      header.classList.add('shrink');
    } else {
      header.classList.remove('shrink');
    }
    updateLayout();
  });

  window.addEventListener('resize', updateLayout);
  window.addEventListener('load', updateLayout);

  // ===== SIDEBAR LOGIC =====

  const sidebar = document.getElementById("librarySidebar");
  const overlay = document.getElementById("overlay");
  const storyList = document.getElementById("storyList");
  const searchInput = document.getElementById("searchInput");

  function toggleLibrary() {
    sidebar.classList.toggle("active");
    overlay.classList.toggle("active");
  }

  let storiesData = [];

  // ðŸ”¥ Path chuáº©n (vÃ¬ Ä‘ang á»Ÿ /stories/slug/index.html)
  fetch("../../stories.json")
    .then(res => res.json())
    .then(data => {
      storiesData = data;
      renderStories(data);
    })
    .catch(err => console.error("Lá»—i load stories.json:", err));

  function renderStories(data) {
    storyList.innerHTML = "";

    // ðŸ”¥ Láº¥y slug an toÃ n (khÃ´ng phá»¥ thuá»™c cáº¥u trÃºc deploy)
    const pathParts = window.location.pathname.split("/");
    const currentSlug = pathParts[pathParts.length - 2];

    data.forEach((story, index) => {
      const li = document.createElement("li");

      // ðŸ”¥ Giá»›i háº¡n animation delay
      li.style.animationDelay = `${Math.min(index * 0.03, 0.3)}s`;

      const a = document.createElement("a");
      a.href = `/web-doc-truyen/stories/${story.slug}/`;
      a.textContent = `${story.title} (${story.chapters} chÆ°Æ¡ng)`;

      // ðŸ”¥ Highlight truyá»‡n Ä‘ang Ä‘á»c
      if (story.slug === currentSlug) {
        a.style.background = "#e0e7ff";
      }

      // ðŸ”¥ Auto Ä‘Ã³ng sidebar khi click
      a.addEventListener("click", () => {
        sidebar.classList.remove("active");
        overlay.classList.remove("active");
      });

      li.appendChild(a);
      storyList.appendChild(li);
    });
  }

  // ðŸ”¥ TÃ¬m kiáº¿m realtime
  searchInput.addEventListener("input", function () {
    const keyword = this.value.toLowerCase();

    const filtered = storiesData.filter(story =>
      story.title.toLowerCase().includes(keyword)
    );

    renderStories(filtered);
  });
</script>